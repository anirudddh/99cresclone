"use strict";function Buffer(){this._container=[],this._subscriptions=[],Object.defineProperties(this,{size:{get:function(){return this._container.length}}})}function initBatching(a){function b(a){a.data&&a.data.event&&"beforeunload"==a.data.event&&h._container.length>0&&h._container.length<5&&(executeBatch(h),clearInterval(i),d())}function c(a){a.size==f&&(executeBatch(a),clearInterval(i),d())}function d(){return setInterval(executeBatch.bind(this,h),g)}self.removeEventListener("message",initBatching);var e=a.data,f=e.batchSize,g=e.batchTimeout,h=new Buffer,i=null;h.subscribe(c),self.addEventListener("message",h.push.bind(h)),self.addEventListener("message",b),i=d()}function executeBatch(a){if(a.size){var b,c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;c.push(JSON.stringify(i.data))}}catch(a){e=!0,f=a}finally{try{d||null==h.return||h.return()}finally{if(e)throw f}}return b="trackingData[]=["+encodeURIComponent(c.join(","))+"]",a.flush(),fetch_retry("/do/clickStreamTracking/ClickStream/trackData",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:b},3).catch(console.error)}}function fetch_retry(a,b,c){return fetch(a,b).catch(function(d){if(1===c)throw d;return fetch_retry(a,b,c-1)})}Buffer.prototype.subscribe=function(a){var b=this,c=this._subscriptions.push(a);return function(){b._subscriptions=b._subscriptions.filter(function(a,b){return b!=c})}},Buffer.prototype.emit=function(){var a=this;this._subscriptions.forEach(function(b){b(a)})},Buffer.prototype.push=function(a){return a&&a.data&&a.data.event&&"beforeunload"==a.data.event||this._container.push(a),this.emit(),this},Buffer.prototype.flush=function(){return this._container=[],this},Buffer.prototype.getStash=function(){return this._container.slice()},Buffer.prototype[Symbol.iterator]=function(){function a(){return{value:c[b++],done:!(b-1 in c)}}var b=0,c=this._container.slice();return{next:a}},self.addEventListener("message",initBatching);